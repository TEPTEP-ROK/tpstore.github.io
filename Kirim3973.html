<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Pembagian RSS Sama Rata</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#020617;color:#e5e7eb;padding:14px}
h2{text-align:center}
.card{border:1px solid #1e293b;border-radius:8px;padding:12px;margin-bottom:14px}
input{width:100%;padding:6px;margin:4px 0;background:#020617;color:#e5e7eb;border:1px solid #334155;border-radius:6px}
button{padding:10px;width:100%;background:#2563eb;color:#fff;border:none;border-radius:6px;margin-top:6px}
button.secondary{background:#475569}
table{width:100%;border-collapse:collapse;margin-top:8px}
th,td{border:1px solid #334155;padding:6px;text-align:center}
.result{white-space:pre-line;background:#020617;border:1px solid #334155;padding:10px;border-radius:6px;margin-top:10px}
.check{transform:scale(1.2)}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:6px}
</style>
</head>

<body>

<h2>Pembagian Sumberdaya Sama Rata</h2>

<div class="card">
<h3>Kebutuhan Buyer (M)</h3>
<input id="bJ" type="number" placeholder="Jagung">
<input id="bK" type="number" placeholder="Kayu">
<input id="bB" type="number" placeholder="Batu">
<input id="bE" type="number" placeholder="Emas">
</div>

<div class="card">
<h3>Rate Bayar Anggota (Rp / 1M)</h3>
<input id="rJ" type="number" placeholder="Jagung">
<input id="rK" type="number" placeholder="Kayu">
<input id="rB" type="number" placeholder="Batu">
<input id="rE" type="number" placeholder="Emas">
</div>

<div class="card">
<button onclick="ambilSheet()">Ambil Stok dari Google Sheet</button>
</div>

<div class="card">
<h3>Data Anggota</h3>

<div class="grid2">
<button onclick="centangSemua()">Centang Semua</button>
<button class="secondary" onclick="lepasSemua()">Lepas Semua</button>
</div>

<div id="tabel"></div>
</div>

<div class="card">
<button onclick="hitung()">Hitung Pembagian</button>
<button onclick="salinKirim()">Salin Pembagian Kirim</button>
<button onclick="salinAll()">Salin Seluruh Hasil</button>
<div id="hasil" class="result"></div>
</div>

<script>
const sheetURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vSKun1JF9TKDdbbLewywcz7Kh51koV2WiSMzD6ttZXRSGA9b4C5J-4H0_PCO2AMg9SimLvi8zCGvcVd/pub?output=csv";

let teksKirim="", teksAll="";

function ambilSheet(){
 fetch(sheetURL)
 .then(r=>r.text())
 .then(t=>{
  let rows=t.trim().split("\n").slice(1);
  let h='<table><tr><th>Ikut</th><th>Nama</th><th>Jagung</th><th>Kayu</th><th>Batu</th><th>Emas</th></tr>';
  rows.forEach(r=>{
   let c=r.split(",");
   h+=`<tr>
    <td><input type="checkbox" class="ikut check" checked></td>
    <td><input class="n" value="${c[0]}"></td>
    <td><input class="j" type="number" value="${c[1]}"></td>
    <td><input class="k" type="number" value="${c[2]}"></td>
    <td><input class="b" type="number" value="${c[3]}"></td>
    <td><input class="e" type="number" value="${c[4]}"></td>
   </tr>`;
  });
  tabel.innerHTML=h;
 });
}

function centangSemua(){
 document.querySelectorAll(".ikut").forEach(c=>c.checked=true);
}

function lepasSemua(){
 document.querySelectorAll(".ikut").forEach(c=>c.checked=false);
}

function hitung(){
 let need={j:+bJ.value||0,k:+bK.value||0,b:+bB.value||0,e:+bE.value||0};
 let rate={j:+rJ.value||0,k:+rK.value||0,b:+rB.value||0,e:+rE.value||0};

 let ikut=[...document.querySelectorAll(".ikut")];
 let n=[...document.querySelectorAll(".n")];
 let sj=[...document.querySelectorAll(".j")];
 let sk=[...document.querySelectorAll(".k")];
 let sb=[...document.querySelectorAll(".b")];
 let se=[...document.querySelectorAll(".e")];

 let aktif=[];
 for(let i=0;i<n.length;i++){
  if(ikut[i].checked){
   aktif.push({
    nama:n[i].value,
    stok:{j:+sj[i].value,k:+sk[i].value,b:+sb[i].value,e:+se[i].value},
    kirim:{j:0,k:0,b:0,e:0}
   });
  }
 }

 if(aktif.length===0){
  alert("Tidak ada anggota yang ikut");
  return;
 }

 ["j","k","b","e"].forEach(x=>{
  let sisa=need[x];
  while(sisa>0){
   let jalan=false;
   for(let a of aktif){
    if(a.stok[x]-a.kirim[x]>0 && sisa>0){
     a.kirim[x]++;
     sisa--;
     jalan=true;
    }
   }
   if(!jalan) break;
  }
 });

 teksKirim="PEMBAGIAN KIRIM RSS\n\n";
 teksAll=
`RATE (Rp / 1M)
ðŸŒ½ Jagung : Rp ${rate.j.toLocaleString("id-ID")}
ðŸªµ  Kayu   : Rp ${rate.k.toLocaleString("id-ID")}
ðŸª¨  Batu   : Rp ${rate.b.toLocaleString("id-ID")}
ðŸª™Emas   : Rp ${rate.e.toLocaleString("id-ID")}

HASIL PEMBAGIAN\n\n`;

 let total=0;

 aktif.forEach(a=>{
  let income=
   a.kirim.j*rate.j+
   a.kirim.k*rate.k+
   a.kirim.b*rate.b+
   a.kirim.e*rate.e;
  total+=income;

  teksKirim+=`${a.nama} kirim ${a.kirim.j}/${a.kirim.k}/${a.kirim.b}/${a.kirim.e}\n`;

  teksAll+=`${a.nama}
Kirim : ${a.kirim.j}/${a.kirim.k}/${a.kirim.b}/${a.kirim.e}
Penghasilan : Rp ${income.toLocaleString("id-ID")}

`;
 });

 teksAll+=`TOTAL PENGHASILAN: Rp ${total.toLocaleString("id-ID")}`;
 hasil.innerText=teksAll;
}

function salinKirim(){
 navigator.clipboard.writeText(teksKirim);
 alert("Pembagian kirim disalin");
}
function salinAll(){
 navigator.clipboard.writeText(teksAll);
 alert("Seluruh hasil disalin");
}
</script>

</body>
</html>
